<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Survival Metalearners • survlearners</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Survival Metalearners">
<meta property="og:description" content="Benchmark survival-metalearners.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">survlearners</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/metalearners.html">Treatment heterogeneity for Survival Outcomes</a>
    </li>
    <li>
      <a href="articles/select_metalearners.html">Metalearners selection</a>
    </li>
    <li>
      <a href="articles/case_study.html">A case study with metalearners</a>
    </li>
  </ul>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">


<div class="section level1">
<div class="page-header"><h1 id="metalearners-for-survival-data">Metalearners for Survival Data<a class="anchor" aria-label="anchor" href="#metalearners-for-survival-data"></a>
</h1></div>
<p>This repository contains the extended implementations of five state-of-the-art metalearners for survival outcomes. Metalearners are specific meta-algorithms that leverage predictive models, e.g., machine learning models, to solve the causal task of estimating treatment heterogeneity. While metalearners (S-, T-, X-, M-, and R-learners) have been developed for uncensored continuous or binary data, survlearners provide their adapted executions to the survival setting through inverse probability of censoring weighting when combined with two popular machine learning strategies (Lasso and generalized random forests).</p>
<p>For a tutorial of these metalearners with mathematical underpinning, please refer to the Chapter named <a href="">Treatment heterogeneity for survival outcomes</a> in the <strong>Handbook of Matching and Weighting Adjustments for Causal Inference</strong>. In addition, this chapter includes a benchmarking study of the five metalearners via a comprehensive simulation study to assess the impacts of several important factors in the data generating process (the complexity of the baseline risk function, the complexity of the CATE function, the magnitude of the heterogeneity in treatment effects, the censoring mechanism, and the imbalance of treated and control units) on estimation performance. The summarized recommendations and considerations for choosing and applying metalearners and machine learning models for HTE estimation are incorporated into survlearners.</p>
<p>Some links for getting started</p>
<ul>
<li>The <a href="https://som-shahlab.github.io/survlearners/" class="external-link">tutorial</a> contains usage examples and relevant references</li>
<li>The replication code for the metalearner benchmarking study is available in <a href="https://github.com/som-shahlab/survlearners/tree/master/experiments">experiments</a>
</li>
</ul>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>The current version of survlearners can be installed from source using <a href="https://cran.r-project.org/web/packages/remotes/index.html" class="external-link">remotes</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"som-shahlab/survlearners"</span>, subdir <span class="op">=</span> <span class="st">"r-package/survlearners"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="usage-examples">Usage Examples<a class="anchor" aria-label="anchor" href="#usage-examples"></a>
</h3>
<p>The following script demonstrates the application of R-learner with random survival forest and Lasso for estimating the heterogenous treatment effects on the absolute difference scale, i.e., difference in survival probabilities at the median follow-up time. For examples of applying other types of metalearners, please refer to the R <a href="https://som-shahlab.github.io/survlearners/reference/index.html" class="external-link">documentation</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">survlearners</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate data</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span>; <span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span><span class="va">t0</span> <span class="op">&lt;-</span> <span class="fl">0.2</span></span>
<span><span class="va">Y.max</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">p</span><span class="op">)</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">numeratorT</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="cn">T</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">numeratorT</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span> ,<span class="fl">1</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span><span class="op">-</span><span class="fl">0.5</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span> ,<span class="fl">2</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">W</span><span class="op">)</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span></span>
<span><span class="va">failure.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="cn">T</span>, <span class="va">Y.max</span><span class="op">)</span></span>
<span><span class="va">numeratorC</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">censor.time</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">numeratorC</span> <span class="op">/</span> <span class="op">(</span><span class="fl">4</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">^</span> <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">failure.time</span>, <span class="va">censor.time</span><span class="op">)</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">failure.time</span> <span class="op">&lt;=</span> <span class="va">censor.time</span><span class="op">)</span></span>
<span><span class="va">n.test</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">X.test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n.test</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>, <span class="va">n.test</span>, <span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Conditional average treatment effects (CATEs)</span></span>
<span><span class="co"># Train a CATE model using R-learner with random survival forest (RSF) and Lasso</span></span>
<span><span class="co"># RSF is used for estimating the nuisance parameters, e.g., mean outcome and censoring weights</span></span>
<span><span class="co"># Lasso is used for estimating the target parameter CATE</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/surv_rl_grf_lasso.html">surv_rl_grf_lasso</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span>, <span class="va">W</span>, <span class="va">D</span>, <span class="va">t0</span>, W.hat <span class="op">=</span> <span class="fl">0.5</span>, cen.fit <span class="op">=</span> <span class="st">"survival.forest"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimating conditional average treatment effects for the test sample</span></span>
<span><span class="va">cate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">X.test</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="funding">Funding<a class="anchor" aria-label="anchor" href="#funding"></a>
</h3>
<p>This work was supported by R01 HL144555 from the National Heart, Lung, and Blood Institute (NHLBI).</p>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<p>Xu, Y., Ignatiadis, N., Sverdrup E., Fleming S., Wager, S., and Shah, N. (2022). <strong>Handbook of Matching and Weighting Adjustments for Causal Inference. Chapter: Treatment Heterogeneity with Survival Outcomes.</strong> Chapman &amp; Hall/CRC Press (forthcoming). [<a href="https://arxiv.org/abs/2207.07758" class="external-link">arxiv</a>]</p>
<p>Athey S., Tibshirani J., and Wager S. (2019). <strong>Generalized random forests.</strong> The Annals of Statistics, 47(2):1148–1178. [<a href="https://projecteuclid.org/journals/annals-of-statistics/volume-47/issue-2/Generalized-random-forests/10.1214/18-AOS1709.full" class="external-link">paper</a>]</p>
<p>Tibshirani R. (1997). <strong>The lasso method for variable selection in the Cox model.</strong> Statistics in medicine, 16(4):385–395. [<a href="https://onlinelibrary.wiley.com/doi/abs/10.1002/(SICI)1097-0258(19970228)16:4%3C385::AID-SIM380%3E3.0.CO;2-3" class="external-link">paper</a>]</p>
<p>Van der Laan M. J. and Robins J. M. (2003). <strong>Unified methods for censored longitudinal data and causality,</strong> volume 5. Springer. [<a href="https://link.springer.com/book/10.1007/978-0-387-21700-0" class="external-link">paper</a>]</p>
<p>Tsiatis. A. A. (2006). Semiparametric theory and missing data. [<a href="https://link.springer.com/book/10.1007/0-387-37345-4" class="external-link">paper</a>]</p>
<p>Tian L., Alizadeh A., Gentles A., and Tibshirani R. (2014). <strong>A simple method for estimating interactions between a treatment and a large number of covariates.</strong> Journal of the American Statistical Association, 109. [<a href="https://www.tandfonline.com/doi/full/10.1080/01621459.2014.951443" class="external-link">paper</a>]</p>
<p>Kunzel S. R., Sekhon J. S., Bickel P. J., and Yu B. (2019). <strong>Metalearners for estimating heterogeneous treatment effects using machine learning.</strong> Proceedings of the national academy of sciences, 116(10):4156–4165, 2019. [<a href="https://www.pnas.org/doi/abs/10.1073/pnas.1804597116" class="external-link">paper</a>]</p>
<p>Nie X. and Wager S. (2021). <strong>Quasi-oracle estimation of heterogeneous treatment effects.</strong> Biometrika, 108(2):299–319. [<a href="https://academic.oup.com/biomet/article/108/2/299/5911092?login=true" class="external-link">paper</a>]</p>
<p>Cui Y., Kosorok M. R., Sverdrup E., Wager S., and Zhu R. (2020). <strong>Estimating heterogeneous treatment effects with right-censored data via causal survival forests.</strong> [<a href="https://arxiv.org/abs/2001.09887" class="external-link">arxiv</a>]</p>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing survlearners</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Yizhe Xu <br><small class="roles"> Author, maintainer </small>  </li>
<li>Nikolaos Ignatiadis <br><small class="roles"> Author </small>  </li>
<li>Erik Sverdrup <br><small class="roles"> Author </small>  </li>
<li>Scott Fleming <br><small class="roles"> Author </small>  </li>
<li>Stefan Wager <br><small class="roles"> Author </small>  </li>
<li>Nigam Shah <br><small class="roles"> Author </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/som-shahlab/survlearners/actions/workflows/main.yml"><img src="https://github.com/som-shahlab/survlearners/actions/workflows/main.yml/badge.svg" alt="ci"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Yizhe Xu, Nikolaos Ignatiadis, Erik Sverdrup, Scott Fleming, Stefan Wager, Nigam Shah.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
